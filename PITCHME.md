### Практическое руководство по созданию PyPI пакета

> Евгений Бовыкин, Computer Science Center
>
> Марк Заславский, OSLL
---

### Полезные ссылки
Проект-пример: https://goo.gl/dcwWMQ
```sh
git checkout 1.0
```
PyPI live: pypi.python.org

PyPI test: testpypi.python.org

---

### Cодержание
- Перед началом работы
- Рефакторинг проекта, изменение его структуры
- Локальная установка
- Первая публикация
- Как работать дальше

---

### Перед началом работы
#### Установка Python, pip
- Linux - python 2.7 установлен
- Windows - https://www.python.org/downloads/windows/

---

### Перед началом работы
#### Регистрация на PyPI
PyPI live: pypi.python.org

PyPI test: testpypi.python.org

---

### Перед началом работы
#### Регистрация на PyPI
~.pypirc для удобства загрузки

---

### Рефакторинг проекта, изменение его структуры
#### Основные функции работают
Создаем папку с именем, равным имени вашего проекта. Скидываем все файлы туда, делаем ее модулем.

---

### Рефакторинг проекта, изменение его структуры
#### Тесты работают
Тесты кладем в папку **project_name/test**. 

Для запуска
```sh
python -m unittest discover
```

**scripts/run_tests.sh** для автоматизации

---

### Рефакторинг проекта, изменение его структуры
#### Испольняемые файлы работают (почти)
Испольняемые файлы помещаем в папку bin.

Для их работы требуется установка пакета, которая будет в следующем шаге.

---

### Локальная установка
#### Создание пакета
Создаем setup.py - файл, описывающий наш проект

Для установки
```sh
pip install . --user
```

---

### Локальная установка
#### Локальное тестирование
Чтобы не устанавливать пакет каждый раз при тестировании, используем
```sh
pip install -e . --user
```

---

### Первая публикация
#### Перед публикацией
Обновляем версию в setup.py, коммитим.
```sh
git tag version
git push origin master --tags
```

---

### Первая публикация
#### Перед публикацией
Генерируем README при помощи pandoc
```sh
pandoc --from=markdown --to=rst --output=README README.md
```

---

### Первая публикация
#### Перед публикацией
Создаем setup.cfg

---

### Первая публикация
#### Публикация в PyPI test
Регистрируем пакет
```sh
python setup.py register -r pypitest
```

Загружаем
```sh
python setup.py sdist upload -r pypitest
```

---

### Первая публикация
#### Публикация в PyPI test
Проверяем установку
```sh
pip install -i https://testpypi.python.org/pypi <package name>
```

---

### Первая публикация
#### Публикация в PyPI live
Регистрируем пакет
```sh
python setup.py register -r pypi
```

Загружаем
```sh
python setup.py sdist upload -r pypi
```

---

### Первая публикация
#### Публикация в PyPI live
Проверяем установку
```sh
pip uninstall <package name>
pip install <package name> --user
```

---

### Как работать дальше
Общий план обновления версии

- Коммитим все изменения
- Обновляем версию, git tag
- Загружаем на PyPI test, проверяем
- Загружаем на PyPI live, проверяем
